#include "parser.h"
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <stdint.h>
#include <stdbool.h>

const uint8_t init001[24] = {0x02,0x00,0x11,0x00,0x13,0x00,0x03,0x00,0x02,0x00,0x01,0x00,0x01,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x01,0x01};
const uint8_t ans0111[36] = {0x02,0x01,0x11,0x00,0x1f,0x00,0x03,0x00,0x02,0x00,0x01,0x00,0x04,0x00,0x02,0x00,0x01,0x00,0x01,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x02,0x00,0x00,0x00,0x07,0x00,0x01,0x00};
const uint8_t ans0117[31] = {0x02,0x01,0x17,0x00,0x1a,0x00,0x03,0x00,0x02,0x00,0x01,0x00,0x04,0x00,0x02,0x00,0x01,0x00,0x01,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x06,0x00,0x02,0x00,0x64};

const uint8_t emm[0xe0] = {
0x02,0x02,0x11,0x00,0xda,0x00,0x03,0x00,0x02,0x00,0x01,0x00,0x04,0x00,0x02,0x00,
0x01,0x00,0x01,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x02,0x00,0x00,0x00,
0x05,0x00,0xbc,0x47,0x5f,0xff,0x10,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF, //40
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};

void setup(int runde,char *sendbuffer,uint8_t debug){
int i;
     //send(SendingSocket, init001, ((init001[4]+5) &0xff ), 0);
     switch(runde){
     case 0:{
        if(debug == 1){
            for(i =0;i < init001[4]+5;i++){printf("%02X ",init001[i]&0xff);}
        }
        for(i =0;i < init001[4]+5;i++){sendbuffer[i] = (init001[i]&0xff);}
        break;
     }
    case 1:{
        if(debug == 1){
            for(i =0;i < ans0111[4]+5;i++){printf("%02X ",ans0111[i]&0xff);}
        }
        for(i =0;i < ans0111[4]+5;i++){sendbuffer[i] = (ans0111[i]&0xff);}
        break;
    }
    case 2:{
        if(debug == 1){
            for(i =0;i < ans0117[4]+5;i++){printf("%02X ",ans0117[i]&0xff);}
        }
        for(i =0;i < ans0117[4]+5;i++){sendbuffer[i] = (ans0117[i]&0xff);}
        break;
    }
}
}

void genframe(char *sendbuffer){
    memcpy(&sendbuffer[0],&emm[0],emm[4]+5);
}

void copyemm(char *out,uint8_t *in){
            memset(&out[40],0,62);
            memcpy(&out[40],&in[2],78); //(in[2]+3)
}
